var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,a){function s(e){try{h(r.next(e))}catch(t){a(t)}}function o(e){try{h(r["throw"](e))}catch(t){a(t)}}function h(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,o)}h((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(s=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(r){i=[6,r],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},GridItemData=function(){function e(){this.value=0}return Object.defineProperty(e.prototype,"disX",{get:function(){var e=62,t=20+145*this.j+e;return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disY",{get:function(){var e=62,t=20+145*this.i+e;return t},enumerable:!0,configurable:!0}),e}();__reflect(GridItemData.prototype,"GridItemData");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var GAME_SCENE_WIDTH_DEFINE=720,GAME_SCENE_HEIGHT_DEFINE=1280,GAME_START_MENU=1e3,GAME_MAIN=1001,Define=function(){function e(){}return e}();__reflect(Define.prototype,"Define");var SystemData=function(){function e(){}return e}();__reflect(SystemData.prototype,"SystemData");var UserData=function(){function e(){}return e}();__reflect(UserData.prototype,"UserData");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.login()];case 2:return t.sent(),[4,platform.getUserInfo()];case 3:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){this.addChild(new GameSceneController)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Square=function(e){function t(t,i){var r=e.call(this)||this;return r.isNeedMove=!1,r.isNeedCombine=!1,r.init(t,i),r}return __extends(t,e),t.prototype.init=function(e,t){this.width=this.m_vWidth=e,this.height=this.m_vHeight=t,this.m_vValue=0,this.m_pItem=new egret.DisplayObjectContainer,this.addChild(this.m_pItem),this.m_pBg=new egret.Shape,this.m_pItem.addChild(this.m_pBg),this.m_pBg.graphics.beginFill(this.getColorByValue(this.m_vValue)),this.m_pBg.graphics.drawRoundRect(0,0,e,t,e/6),this.m_pBg.graphics.endFill(),this.m_pBg.anchorOffsetX=this.m_pBg.x=e/2,this.m_pBg.anchorOffsetY=this.m_pBg.y=e/2,this.m_pBg.scaleX=this.m_pBg.scaleY=.9,this.m_pShowTextField=new egret.TextField,this.m_pItem.addChild(this.m_pShowTextField),this.m_pShowTextField.bold=!0,this.m_pShowTextField.width=e,this.m_pShowTextField.height=t,this.m_pShowTextField.textAlign=egret.HorizontalAlign.CENTER,this.m_pShowTextField.verticalAlign=egret.VerticalAlign.MIDDLE,this.refreshSquare()},t.prototype.refreshSquare=function(){this.m_pShowTextField.size=this.getTextSize(this.m_vValue),this.m_vShowNumber=Math.pow(2,this.m_vValue),this.m_pShowTextField.text=String(this.m_vShowNumber),this.m_pShowTextField.textColor=16777215-this.getColorByValue(this.m_vValue),this.m_pBg.graphics.beginFill(this.getColorByValue(this.m_vValue)),this.m_pBg.graphics.drawRoundRect(0,0,this.m_vWidth,this.m_vHeight,this.m_vWidth/6),this.m_pBg.graphics.endFill()},t.prototype.reset=function(){this.isNeedMove=!1,this.isNeedCombine=!1},t.prototype.setValue=function(e){this.m_vValue=e,this.refreshSquare()},t.prototype.setValueA=function(e){e>this.m_vValue&&(this.m_vValue++,this.refreshSquare())},t.prototype.setValueAdd=function(){this.setValue(this.m_vValue+1)},t.prototype.delThis=function(){null!=this.parent&&this.parent.removeChild(this)},t.prototype.getTextSize=function(e){switch(e){case 0:return 0;case 1:case 2:case 3:return 80;case 4:case 5:case 6:return 75;case 7:case 8:case 9:return 70;case 10:case 11:case 12:case 13:return 65;case 14:case 15:case 16:return 50}return 0},t.prototype.getColorByValue=function(e){switch(e){case 0:return 11843239;case 1:return 16643297;case 2:return 16574914;case 3:return 16238696;case 4:return 16423550;case 5:return 16282702;case 6:return 15613451;case 7:return 14867724;case 8:return 3456524;case 9:return 5366719;case 10:return 8044915;case 11:return 6723022}return 11843239},t}(egret.DisplayObjectContainer);__reflect(Square.prototype,"Square");var Example=function(e){function t(){var i=e.call(this)||this;return t.m_pThis=i,i.initScene(),i}return __extends(t,e),t.prototype.initScene=function(){this.width=GAME_SCENE_WIDTH_DEFINE,this.height=GAME_SCENE_HEIGHT_DEFINE},t.prototype.delThis=function(){this.onDestroy()},t.prototype.onDestroy=function(){null!=t.m_pThis&&(t.m_pThis=null)},t}(egret.DisplayObjectContainer);__reflect(Example.prototype,"Example");var GameMain=function(e){function t(){var i=e.call(this)||this;return t.m_pThis=i,i.initScene(),i}return __extends(t,e),t.prototype.initScene=function(){this.width=GAME_SCENE_WIDTH_DEFINE,this.height=GAME_SCENE_HEIGHT_DEFINE,this.touchEnabled=!0;var e=new egret.Shape;this.addChild(e),e.graphics.beginFill(15724527),e.graphics.drawRect(0,0,720,1280),e.graphics.endFill(),this.m_pPlayGameBody=new PlayGameBody,this.addChild(this.m_pPlayGameBody),this.m_pGameOverView=new egret.DisplayObjectContainer,this.addChild(this.m_pGameOverView),this.m_pGameOverView.visible=!1;var t=new egret.Shape;this.m_pGameOverView.addChildAt(t,0),t.graphics.beginFill(4473924,.8),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill();var i=new egret.TextField;this.m_pGameOverView.addChild(i),i.text="当前得分",i.fontFamily="KaiTi",i.size=65,i.anchorOffsetX=i.textWidth/2,i.anchorOffsetY=i.textHeight/2,i.x=this.width/2,i.y=this.height/2-100,this.m_pGameOverScores=new egret.TextField,this.m_pGameOverView.addChild(this.m_pGameOverScores),this.m_pGameOverScores.text="12345",this.m_pGameOverScores.bold=!0,this.m_pGameOverScores.textColor=15250432,this.m_pGameOverScores.size=80,this.m_pGameOverScores.anchorOffsetX=this.m_pGameOverScores.textWidth/2,this.m_pGameOverScores.anchorOffsetY=this.m_pGameOverScores.textHeight/2,this.m_pGameOverScores.x=this.width/2,this.m_pGameOverScores.y=this.height/2,this.m_pNewGame=new egret.Bitmap(RES.getRes("replay_png")),this.m_pGameOverView.addChild(this.m_pNewGame),this.m_pNewGame.touchEnabled=!0,this.m_pNewGame.anchorOffsetX=this.m_pNewGame.width/2,this.m_pNewGame.anchorOffsetY=this.m_pNewGame.height/2,this.m_pNewGame.x=this.width/2,this.m_pNewGame.y=this.height/2+100,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.m_pPlayGameBody.onTouchBegin,this.m_pPlayGameBody),this.addEventListener(egret.TouchEvent.TOUCH_END,this.m_pPlayGameBody.onTouchEnd,this.m_pPlayGameBody),this.m_pNewGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameRestartInit,this)},t.prototype.gameRestartInit=function(){this.m_pGameOverView.visible=!1,this.m_pPlayGameBody.gameRestartInit()},t.prototype.showGameOverScores=function(e){this.setChildIndex(this.m_pGameOverView,-1),this.m_pGameOverView.visible=!0,this.m_pGameOverScores.text=String(e),this.m_pGameOverScores.anchorOffsetX=this.m_pGameOverScores.textWidth/2,this.m_pGameOverScores.anchorOffsetY=this.m_pGameOverScores.textHeight/2,this.m_pGameOverScores.x=this.width/2,this.m_pGameOverScores.y=this.height/2},t.prototype.delThis=function(){this.onDestroy()},t.prototype.onDestroy=function(){null!=t.m_pThis&&(t.m_pThis=null)},t}(egret.DisplayObjectContainer);__reflect(GameMain.prototype,"GameMain");var GameSceneController=function(e){function t(){var i=e.call(this)||this;return t.m_pThis=i,i.initScene(),t.changeScene(GAME_START_MENU),i}return __extends(t,e),t.prototype.initScene=function(){this.width=GAME_SCENE_WIDTH_DEFINE,this.height=GAME_SCENE_HEIGHT_DEFINE},t.prototype.onDestroy=function(){null!=t.m_pThis&&(t.m_pThis=null)},t.changeScene=function(e){switch(e){case GAME_START_MENU:t.m_pThis.addChild(new GameStartMenu);break;case GAME_MAIN:t.m_pThis.addChild(new GameMain)}},t}(egret.DisplayObjectContainer);__reflect(GameSceneController.prototype,"GameSceneController");var GameStartMenu=function(e){function t(){var i=e.call(this)||this;return t.m_pThis=i,i.initScene(),i}return __extends(t,e),t.prototype.initScene=function(){this.width=GAME_SCENE_WIDTH_DEFINE,this.height=GAME_SCENE_HEIGHT_DEFINE;var e=new egret.Shape;this.addChild(e),e.graphics.beginFill(15253801,.7),e.graphics.drawRect(0,0,720,1280),e.graphics.endFill();var t=new egret.TextField;this.addChild(t),t.touchEnabled=!0,t.text="点击开始游戏",t.size=40,t.name="gameStart",t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=360,t.y=640,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn,this),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,t),t.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,t)},t.prototype.onBtn=function(e){switch(e.currentTarget.name){case"gameStart":this.delThis(),GameSceneController.changeScene(GAME_MAIN)}},t.prototype.onTouchBegin=function(){this.scaleX=this.scaleY=.95},t.prototype.onTouchEnd=function(){this.scaleX=this.scaleY=1},t.prototype.delThis=function(){null!=t.m_pThis.parent&&t.m_pThis.parent.removeChild(t.m_pThis),this.onDestroy()},t.prototype.onDestroy=function(){null!=t.m_pThis&&(t.m_pThis=null)},t}(egret.DisplayObjectContainer);__reflect(GameStartMenu.prototype,"GameStartMenu");var PlayGameBody=function(e){function t(){var t=e.call(this)||this;return t._grade=0,t._best=0,t.running=0,t.record=0,t.bestRecord=0,t.initScene(),t.gameRestartInit(),t.initEventListener(),t}return __extends(t,e),t.prototype.initScene=function(){t.m_pThis=this,this.m_vWidth=700,this.width=this.height=this.m_vWidth,this.anchorOffsetX=this.anchorOffsetY=350,this.x=360,this.y=640,this.touchEnabled=!0},t.prototype.gameRestartInit=function(){this.removeChildren();var e=new egret.Shape;this.addChildAt(e,0),e.graphics.beginFill(9869700),e.graphics.drawRect(0,0,this.m_vWidth,this.m_vWidth),e.graphics.endFill();for(var t=0;4>t;t++)for(var i=0;4>i;i++){var r=new Square(175,175);this.addChild(r),r.y=175*t,r.x=175*i}this.m_pGridData=new Array(4);for(var t=0;4>t;t++){for(var n=new Array(4),i=0;4>i;i++){var a=new GridItemData;a.value=0,a.i=t,a.j=i,a.mX=175*i,a.mY=175*t,n[i]=a}this.m_pGridData[t]=n}this.createSquare()},t.prototype.initEventListener=function(){document.addEventListener("keydown",this.onKeyup)},t.prototype.createSquare=function(){for(var e=0,t=0;4>t;t++)for(var i=0;4>i;i++)null==this.m_pGridData[t][i].item&&e++;if(0!=e)for(var r=Math.floor(Math.random()*e),t=0;4>t;t++)for(var i=0;4>i;i++)if(null==this.m_pGridData[t][i].item){if(0==r){var n=new Square(175,175);return this.addChild(n),n.setValue(1),n.y=175*t,n.x=175*i,this.m_pGridData[t][i].item=n,void(this.m_pGridData[t][i].value=1)}r--}},t.prototype.onTouchBegin=function(e){this.m_vPressX=e.stageX,this.m_vPressY=e.stageY,this.m_vPressTime=new Date},t.prototype.onTouchEnd=function(e){var t=e.stageX-this.m_vPressX,i=e.stageY-this.m_vPressY,r=(new Date).getTime()-this.m_vPressTime.getTime();r>1500||(0!=t||0!=i)&&(i>t&&Math.abs(i)>Math.abs(t)?this.doMove(2):i>t&&Math.abs(i)<Math.abs(t)?this.doMove(3):t>i&&Math.abs(i)<Math.abs(t)?this.doMove(1):t>i&&Math.abs(i)>Math.abs(t)&&this.doMove(0))},t.prototype.onKeyup=function(e){switch(e.keyCode){case 37:t.m_pThis.doMove(3);break;case 38:t.m_pThis.doMove(0);break;case 39:t.m_pThis.doMove(1);break;case 40:t.m_pThis.doMove(2)}},t.prototype.formList=function(e){for(var t=[[],[],[],[]],i=0;4>i;i++)for(var r=0;4>r;r++)switch(e){case 0:t[i].push(this.m_pGridData[r][i]);break;case 1:t[i].push(this.m_pGridData[i][3-r]);break;case 2:t[i].push(this.m_pGridData[3-r][i]);break;case 3:t[i].push(this.m_pGridData[i][r])}return t},t.prototype.doMove=function(e){var t=this;if(this.isGameOver()){var i=this.getGameScores();return void GameMain.m_pThis.showGameOverScores(i)}for(var r,n=this.formList(e),a=0;a<n.length;a++)for(var s,o=function(e){r=-1;for(var i=e+1;i<n[a].length;i++)if(0!=n[a][i].value){r=i;break}if(-1!=r){var o=n[a][e],c=n[a][r],u=60*Math.abs(e-r);if(0==o.value){h.running+=1;var l=c.value,p=o.mX,m=o.mY;o.value=l,o.item=c.item,o.item.refreshSquare(),c.item=null,c.value=0,e--,egret.Tween.get(o.item).to({x:p,y:m},u).call(function(){t.running-=1,t.running<=0&&t.createSquare()},h)}else if(o.value==c.value){h.running+=1,h.getChildIndex(c.item)<h.getChildIndex(o.item)&&h.swapChildren(c.item,o.item);var _=o.item,d=c.item,l=c.value+1;c.value=0,c.item=null,o.value=l,egret.Tween.get(d).to({x:o.mX,y:o.mY},u).to({scaleX:1.1,scaleY:1.1},50).to({scaleX:.9,scaleY:.9},50).to({scaleX:1,scaleY:1},50).call(function(e,i){t.running-=1,_.setValueAdd(),d.delThis(),t.running<=0&&t.createSquare()},h,[_,d])}}s=e},h=this,c=0;c<n[a].length;c++)o(c),c=s},t.prototype.getGameScores=function(){for(var e=0,t=0;4>t;t++)for(var i=0;4>i;i++){var r=this.m_pGridData[t][i].value;0!=r&&(e+=Math.pow(2,r))}return e},t.prototype.isGameOver=function(){for(var e=!0,t=0;4>t;t++)for(var i=0;4>i;i++){if(0==this.m_pGridData[t][i].value)return!1;try{if(this.m_pGridData[t][i].value==this.m_pGridData[t-1][i].value)return!1}catch(r){}try{if(this.m_pGridData[t][i].value==this.m_pGridData[t+1][i].value)return!1}catch(r){}try{if(this.m_pGridData[t][i].value==this.m_pGridData[t][i+1].value)return!1}catch(r){}try{if(this.m_pGridData[t][i].value==this.m_pGridData[t][i-1].value)return!1}catch(r){}}return e},t}(egret.DisplayObjectContainer);__reflect(PlayGameBody.prototype,"PlayGameBody");